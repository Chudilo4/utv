{% extends 'utv_smeta/base.html' %}
{% load django_bootstrap5 %}
{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-2 p-2 bg-secondary overflow-auto" style="height: 821px">
            <h3>Чат к проекту</h3>
            <form method="post" action="{% url 'comment_create' cards.pk %}">
                {% csrf_token %}
                <div class="mb-3">
                    <label class="form-label" for="id_text">Введите ваш комит!</label>
                    <input type="text" name="text" row="20" cols="40" class="form-control" placeholder="Введите ваш комит!" required="" id="id_text">
                </div>
                <button class="btn btn-primary" type="">Отправить</button>
            </form>
            {% for i in cards.comments_set.all %}
            <div class="shadow-none p-3 m-1 bg-light rounded">
                <a href="{% url 'profile' i.author.profileuser.pk %}"><img src="{{ i.author.profileuser.avatar.url }}" alt="mdo" width="32" height="32" class="rounded-circle"></a>
                <strong class="text-gray-dark">{{ i.author.username }}</strong>
                <hr>
                <p class="text-break">{{ i.text }}</p>
                <hr>
                <p>{{ i.created }}</p>
            </div>
            {% endfor %}
        </div>
        <div class="col-6 p-5 bg-light rounded" style="height: 821px">
            <h1>{{ cards.title }}</h1>
            <hr>
            <div class="overflow-auto" style="height: 200px">
            <p>Описание:{{ cards.description }}</p>
            </div>
            <p>Дата создания: {{ cards.created }}</p>
            <p>Дедлайн: {{ cards.date_dedlain }}</p>
            <hr>
            <div style="height: 340px">
            {% for i in cards.worker_set.all %}
                {% if request.user == i.author %}
                    <form class='row' method="post" action="{% url 'worker_update' cards.pk %}">
                    {% csrf_token %}
                    <div class="col-lg-3">
                        <label class="form-label" for="id_actual_time">Фактическое время</label>
                        <input type="number" name="actual_time" value="0" class="form-control" placeholder="Фактическое время" required="" id="id_actual_time">
                    </div>
                    <div class="col-lg-3">
                        <label class="form-label" for="id_scheduled_time">Плановое время</label>
                        <input type="number" name="scheduled_time" value="0" class="form-control" placeholder="Плановое время" required="" id="id_scheduled_time">
                    </div>
                    <div class="col-lg-3">
                    <button class="btn btn-primary" type="">Изменить своё время в проекте</button>
                    </div>
                    </form>
                {% endif %}
            {% endfor %}
            <hr>
            <table class="table">

                  <thead>
                    <tr>
                      <th scope="col">Исполнители</th>
                      <th scope="col">Фактическое время</th>
                      <th scope="col">Плановое время</th>
                      <th scope="col">Удалить</th>
                    </tr>
                  </thead>
                  <tbody>
                   {% for i in cards.worker_set.all %}
                    <tr>
                      <th scope="row"><a href="{% url 'profile' i.author.profileuser.pk %}"><img alt="mdo" width="32" height="32" class="rounded-circle" src="{{ i.author.profileuser.avatar.url }}"></a></th>
                      <td>{{ i.actual_time }}</td>
                      <td>{{ i.scheduled_time }}</td>
                        {% if request.user == i.author %}
                      <td><form method="post" action="{% url 'worker_delete' i.pk %}">{% csrf_token %}<a href="{% url 'worker_delete' i.pk %}" rel="nofollow"><input class="btn btn-danger" type="submit" value="Удалить"></a></form> </td>
                        {% endif %}
                    </tr>
                  {% endfor %}
                  </tbody>

            </table>
            </div>
    <hr>
        </div>
        <div class="col-4 p-5 bg-success" style="height: 821px">
            <h2>Исполнители</h2>
            {% for i in cards.performers.all %}
            <a href="{% url 'profile' i.profileuser.pk %}"><img alt="mdo" width="32" height="32" class="rounded-circle" src="{{ i.profileuser.avatar.url }}"></a>
            {% endfor %}
            <hr>
            <h2>Рабочка</h2>
    </div>
</div>
{% endblock %}